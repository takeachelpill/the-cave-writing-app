<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self'">
  <title>The Cave</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Title Bar -->
  <div id="title-bar">
    <button id="menu-btn" class="title-btn" title="Menu">&#9776;</button>
    <div id="title-text">The Cave</div>
    <div id="window-controls">
      <button id="min-btn" class="title-btn" title="Minimize">&#8722;</button>
      <button id="max-btn" class="title-btn" title="Maximize">&#9633;</button>
      <button id="close-btn" class="title-btn close" title="Close">&#10005;</button>
    </div>
  </div>

  <!-- Main Container -->
  <div id="main-container">
    <!-- Sidebar -->
    <div id="sidebar">
      <div id="sidebar-header">
        <h2 id="project-name">No Project</h2>
      </div>

      <div id="chapters-section">
        <div class="section-header">
          <span>CHAPTERS</span>
          <button id="new-chapter-btn" title="New Chapter (Ctrl+N)">+</button>
        </div>
        <ul id="chapters-list"></ul>
      </div>

      <div id="headings-section">
        <div class="section-header">
          <span>HEADINGS</span>
        </div>
        <ul id="headings-list"></ul>
      </div>

      <div id="todos-section">
        <div class="section-header">
          <span>TODOs</span>
        </div>
        <ul id="todos-list"></ul>
      </div>
    </div>

    <!-- Editor Area -->
    <div id="editor-container">
      <div id="editor-wrapper">
        <div id="editor" contenteditable="true" data-placeholder="Start writing..."></div>
      </div>

      <!-- Welcome Screen (shown when no project) -->
      <div id="welcome-screen">
        <h1>The Cave (A Writing App)</h1>
        <p>A distraction and eye strain-free writing environment</p>
        <div id="welcome-buttons">
          <button id="new-project-btn">New Project</button>
          <button id="open-project-btn">Open Project</button>
        </div>
        <div id="recent-projects">
          <h3>Recent Projects</h3>
          <ul id="recent-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Bar -->
  <div id="status-bar">
    <div id="status-left">
      <button id="settings-btn" title="Settings (Ctrl+,)">&#9881;</button>
      <button id="help-btn" title="Keyboard Shortcuts (?)">?</button>
    </div>
    <div id="status-right">
      <span id="save-status"></span>
      <span class="separator"></span>
      <button id="timer-btn" title="Start/Stop Timer">&#9654;</button>
      <span id="timer">00:00:00</span>
      <span class="separator">|</span>
      <span id="word-count">0 words</span>
      <span class="separator">|</span>
      <span id="clock">00:00</span>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button id="close-settings" class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="font-family">Font Family</label>
          <select id="font-family">
            <option value="Literata">Literata (Serif)</option>
            <option value="iA Writer Mono">iA Writer Mono</option>
            <option value="Source Sans 3">Source Sans (Sans-serif)</option>
            <option value="Georgia">Georgia</option>
            <option value="system-ui">System Default</option>
          </select>
        </div>

        <div class="setting-group">
          <label for="font-size">Font Size: <span id="font-size-value">18</span>px</label>
          <input type="range" id="font-size" min="12" max="32" value="18">
        </div>

        <div class="setting-group">
          <label for="column-width">Column Width: <span id="column-width-value">700</span>px</label>
          <input type="range" id="column-width" min="400" max="2000" value="700">
        </div>

        <div class="setting-group">
          <label for="paragraph-spacing">Space After Paragraphs: <span id="paragraph-spacing-value">1.5</span>em</label>
          <input type="range" id="paragraph-spacing" min="5" max="30" value="15">
        </div>

        <div class="setting-group">
          <label for="dark-mode">
            <input type="checkbox" id="dark-mode" checked>
            Dark Mode
          </label>
        </div>

        <div class="setting-group">
          <label for="auto-pause">
            <input type="checkbox" id="auto-pause" checked>
            Auto-pause timer after 60s inactivity
          </label>
        </div>

        <div class="setting-group setting-divider">
          <div class="setting-row">
            <span class="setting-label">Export project as Word document</span>
            <button id="export-docx-btn" class="btn-secondary">Export as DOCX</button>
          </div>
        </div>

        <div class="setting-group">
          <div class="setting-row">
            <span class="setting-label">Close project and return to home page</span>
            <button id="close-project-btn" class="btn-danger">Close project</button>
          </div>
        </div>

        <div class="setting-group">
          <button id="close-window-btn" class="btn-secondary btn-full">Close Window</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Prompt Modal (for chapter names) -->
  <div id="prompt-modal" class="modal hidden">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="prompt-title">Enter chapter title</h2>
        <button id="close-prompt" class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <input type="text" id="prompt-input" placeholder="Chapter title..." autocomplete="off">
        <div class="modal-actions">
          <button id="prompt-cancel" class="btn-secondary">Cancel</button>
          <button id="prompt-ok" class="btn-primary">Create</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div id="help-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Keyboard Shortcuts</h2>
        <button id="close-help" class="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <table class="shortcuts-table">
          <tr><td><kbd>F11</kbd></td><td>Toggle fullscreen</td></tr>
          <tr><td><kbd>Ctrl</kbd> + <kbd>P</kbd></td><td>Toggle sidebar</td></tr>
          <tr><td><kbd>Ctrl</kbd> + <kbd>N</kbd></td><td>New chapter</td></tr>
          <tr><td><kbd>Ctrl</kbd> + <kbd>O</kbd></td><td>Open project</td></tr>
          <tr><td><kbd>Ctrl</kbd> + <kbd>,</kbd></td><td>Open settings</td></tr>
          <tr><td><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>E</kbd></td><td>Export as DOCX</td></tr>
          <tr><td><kbd>Escape</kbd></td><td>Exit fullscreen / Close dialogs</td></tr>
          <tr><td><kbd>?</kbd></td><td>Show this help</td></tr>
        </table>
        <h3>Editor</h3>
        <table class="shortcuts-table">
          <tr><td>Double-click chapter</td><td>Rename chapter</td></tr>
          <tr><td>Right-click chapter</td><td>Chapter options</td></tr>
          <tr><td>Drag chapter</td><td>Reorder chapters</td></tr>
        </table>
        <h3>Headings</h3>
        <p class="help-note">Start a line with <code>## </code> to create a heading. Headings appear in the sidebar and can be clicked to navigate.</p>
        <h3>TODOs</h3>
        <p class="help-note">Mark text with <code>&lt;angle brackets&gt;</code> to create TODOs that appear in the sidebar.</p>
      </div>
    </div>
  </div>

  <!-- Context Menu -->
  <div id="context-menu" class="hidden">
    <button id="ctx-rename">Rename</button>
    <button id="ctx-delete">Delete</button>
  </div>

  <!-- Scripts -->
  <script src="storage.js"></script>
  <script src="editor.js"></script>
  <script src="sidebar.js"></script>
  <script src="stats.js"></script>
  <script src="settings.js"></script>
  <script src="export.js"></script>
  <script src="app.js"></script>
</body>
</html>
